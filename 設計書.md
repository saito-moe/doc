# システム構成設計書

## 1. 概要
- 機能名：レスポンスPowerBI化
- 開発対象：Java、PowerBI
- 機能の目的・背景：  MIがエクセルで作成している「レスポンス」のPowerBI化
## 2. システム構成図

```mermaid
sequenceDiagram
    participant 直前のジョブ(JBDW030204)

    participant 受注実績データ作成処理(JBDW030205)
    participant ROI出荷者データ作成処理(JBDW030206)
    participant ROI休止者データ作成処理(JBDW030207)
    participant 終了ジョブ
 
    直前のジョブ(JBDW030204)->>受注実績データ作成処理(JBDW030205): ClsSkdb4000JuchuuJissekiData
    受注実績データ作成処理(JBDW030205)->>ROI出荷者データ作成処理(JBDW030206): ClsSkdb4010ROITable(arg="Shukkasha")
    ROI出荷者データ作成処理(JBDW030206)->>ROI休止者データ作成処理(JBDW030207): ClsSkdb4010ROITable(arg="Kyuushisha")
    ROI休止者データ作成処理(JBDW030207)->>終了ジョブ: cls_seps7003_Dummy
```

## 2. ジョブネット
- ジョブ管理台帳<br>\\192.168.1.15\■えがお部署フォルダ\■システム部\ITソリューション2課\001_プロジェクト\023_ジョブ標準\50-1.ジョブ管理台帳.xlsx
- ジョブネット図<br>\\192.168.1.15\■えがお部署フォルダ\■システム部\ITソリューション2課\001_プロジェクト\023_ジョブ標準\51-05.ジョブネット図_JUDW_ＤＷＨ.xlsx

## 3. テーブル設計
　　[テーブル定義書](https://egaogroup.sharepoint.com/:x:/r/sites/shr0012/Shared%20Documents/MI%E3%82%A8%E3%82%AF%E3%82%BB%E3%83%ABPowerBI%E5%8C%96/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9%E6%9B%B8_%E6%97%A2%E5%AD%98PowerBI%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E4%BD%9C%E6%88%90%E8%87%AA%E5%8B%95%E5%8C%96.xlsx?d=w3211ede16db04e89b176004e8988d1ae&csf=1&web=1&e=1NSOiE)
  
## 4. ER図（Entity Relationship Diagram）
<img width="1308" height="1124" alt="image" src="https://github.com/user-attachments/assets/8e0b1a9d-1029-46df-a1bc-40214a482b09" />

<!--
```mermaid
erDiagram
    %% 元データテーブル（ソース）
    KDB_DT_受注実績情報 {
        DATE 受注日 PK
        NUMBER 顧客ID PK
        VARCHAR 分析企画区分1 PK
        VARCHAR 都道府県
        VARCHAR 会員ステージ
        NUMBER 受注金額
    }

    KDB_DM_出荷売上情報 {
        DATE 対象日 PK, FK
        NUMBER 顧客ID PK, FK
        NUMBER 売上金額
        VARCHAR 会員ステージ
    }

    %% マートテーブル（集計後）
    KDB_DT_レスポンス出荷者 {
        DATE 受注日 PK
        VARCHAR 分析企画区分1 PK
        VARCHAR 都道府県 PK
        VARCHAR 会員ステージ PK
        NUMBER 対象者数
        NUMBER 受注金額
        NUMBER 売上金額
    }

    KDB_DT_レスポンス休止者 {
        DATE 受注日 PK
        VARCHAR 分析企画区分1 PK
        VARCHAR 都道府県 PK
        VARCHAR 会員ステージ PK
        NUMBER 対象者数
        NUMBER 受注金額
        NUMBER 売上金額
    }

    %% 関係（日本語コメント付き）
    KDB_DT_受注実績情報 ||--o{ KDB_DT_レスポンス出荷者 : "集計元（受注）"
    KDB_DM_出荷売上情報 ||--o{ KDB_DT_レスポンス出荷者 : "集計元（売上）"

    KDB_DT_受注実績情報 ||--o{ KDB_DT_レスポンス休止者 : "集計元（受注）"
    KDB_DM_出荷売上情報 ||--o{ KDB_DT_レスポンス休止者 : "集計元（売上）"
-->
 
## 5. フローチャート（Entity Relationship Diagram）
```mermaid
graph TD
    A[① KDB_DT_受注実績付加情報テーブル作成<br>※受注日・顧客・企画単位] --> B[② ROI用のデータを作成<br>※受注月・企画・企画名称・会員ステージ名称・新規or再購入・出荷者or休止者 単位]
    C[③ 経費データを作成する] --> E
    B --> E[④ PowerBIに表示する]
```
```mermaid
graph TD
    A[① KDB_DT_受注実績付加情報テーブル作成<br>※受注日・顧客・企画単位] --> A1[①-1 前月の受注実績付加情報を追加<br>※前月のデータを取得し、不足している項目を追加]
```


